{"state":{"content":"<h1>Global State</h1>\n<p>As you've seen, Perseus has full support for reactive state in templates, but what about state that's not associated with any template? The usual example is something like dark mode, which the user might manually disable. In most JavaScript frameworks, you'd bring in some bloated state management system to handle this, but Perseus has global state built in. To declare it, you create a <code>GlobalStateCreator</code>, which will be used to generate some state, and then that'll be made reactive and passed to your templates as their second argument (if they have one, and you'll have to use the <code>#[template_rx]</code> macro).</p>\n<p>The essence of global state is that you can generate it at build-time (though with something like setting dark mode, you'll probably want to ignore whatever was set at build time until you know the browser's preferences) and access it seamlessly from any template. Just like usual <a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/rx\">reactive state</a>, you can make it reactive with <code>#[make_rx(...)]</code>, and you essentially get app-wide MVC with just a few lines of code (and no extra dependencies, all this is completely built into Perseus).</p>\n<details>\n<summary>How would I actually implement dark mode like this?</summary>\n<p>Above is a contrived example. In reality, dark mode is set in two ways: the preference that the browser exposes and the user's own manual setting (usually through a toggle switch in the header or similar). You obviously don't want to start in light mode and then flicker to dark mode once you know the user's preference, that would be awful, so it's far better to rely on a class in the HTML (e.g. if <code>dark</code> is set on the <code>&lt;body&gt;</code>, certain things should be styled in different ways) that you set based on a cookie that you've stored, falling back to the <code>prefers-color-scheme</code> if there's no cookie yet. Perseus is designed to load content and then make it interactive, so if you do this cookie-checking in your Wasm ode, you'll be too late to avoid that flicker, which is why it's better to either do this with a separate Wasm bundle, or with a quick bit of JS written directly into your <code>index.html</code> file. There are plenty of guides on how to achieve this online.</p>\n<p>The role of dark mode comes in in styling that toggle switch mostly, and whenever it changes, you should toggle the <code>dark</code> class on the <code>&lt;body&gt;</code> or similar and update the global state. YOu could to the class toggling with a <code>create_effect</code> that listens for changes in the global state. So, in this case, global state actually isn't crucial, it just makes things cleaner and easier to set up. Unfortunately though, dark mode is irritating with any prerendering because you want to avoid that flicker. (That said, if you don't mind temporarily blinding your 3am users, do whatever you like!)</p>\n</details>\n<h2>Example</h2>\n<p>All the following examples are taken from <a href=\"https://github.com/framesurge/perseus/blob/main/examples/global_state\">here</a>.</p>\n<p>To being with, you'll need to set up a <code>GlobalStateCreator</code>, which will look something like this (it's supposed to be fairly similar to the process of generating state for a <code>Template</code>, but it currently only supports build-time state generation):</p>\n<pre><code class=\"language-rust\">use perseus::{state::GlobalStateCreator, RenderFnResult};\n\npub fn get_global_state_creator() -&gt; GlobalStateCreator {\n    GlobalStateCreator::new().build_state_fn(get_build_state)\n}\n\n#[perseus::make_rx(AppStateRx)]\npub struct AppState {\n    pub test: String,\n}\n\n#[perseus::autoserde(global_build_state)]\npub async fn get_build_state() -&gt; RenderFnResult&lt;AppState&gt; {\n    Ok(AppState {\n        test: &quot;Hello World!&quot;.to_string(),\n    })\n}\n\n</code></pre>\n<p>Then, you can tell Perseus about that by adding it to <code>PerseusApp</code> like so:</p>\n<pre><code class=\"language-rust\">mod error_pages;\nmod global_state;\nmod templates;\n\nuse perseus::{Html, PerseusApp};\n\n#[perseus::main]\npub fn main&lt;G: Html&gt;() -&gt; PerseusApp&lt;G&gt; {\n    PerseusApp::new()\n        .template(crate::templates::index::get_template)\n        .template(crate::templates::about::get_template)\n        .error_pages(crate::error_pages::get_error_pages)\n        .global_state_creator(crate::global_state::get_global_state_creator())\n}\n\n</code></pre>\n<p>Finally, you can use it like so (note the second argument to <code>index_page</code>):</p>\n<pre><code class=\"language-rust\">use perseus::{Html, Template};\nuse sycamore::prelude::{view, SsrNode, View};\n\nuse crate::global_state::AppStateRx;\n\n// This template needs global state, but doesn't have any state of its own, so the first argument is the unit type `()` (which the macro will detect)\n#[perseus::template_rx]\npub fn index_page(_: (), global_state: AppStateRx) -&gt; View&lt;G&gt; {\n    let test = global_state.test;\n    let test_2 = test.clone();\n    view! {\n        // The user can change the global state through an input, and the changes they make will be reflected throughout the app\n        p { (test.get()) }\n        input(bind:value = test_2)\n\n        a(href = &quot;about&quot;, id = &quot;about-link&quot;) { &quot;About&quot; }\n    }\n}\n\n#[perseus::head]\npub fn head() -&gt; View&lt;SsrNode&gt; {\n    view! {\n        title { &quot;Index Page&quot; }\n    }\n}\n\npub fn get_template&lt;G: Html&gt;() -&gt; Template&lt;G&gt; {\n    Template::new(&quot;index&quot;).template(index_page).head(head)\n}\n\n</code></pre>\n<h2>Potential Issues</h2>\n<p>Global state has a quirk that shouldn't be an issue for most, but that can be very helpful to know about if you start to dig into the internals of Perseus. Global state is passed down from the server as a window-level JS variable (as with template state), but it doesn't immediately get deserialized and registered, it's loaded lazily. So, if the user loads fifty templates that don't access global state, your app won't initialize the global state. But, the moment you take it as an argument to a template, it will be set up. This means that, while you can access the global state through the render context (with <code>perseus::get_render_ctx!()</code>), you shouldn't do this except in templates that already take the global state as an argument. It may seem tempting to assume that the user has already gone to another page which has set up global state, but no matter how the flow of your app works, you mustn't assume this because of <a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/freezing\">state freezing</a>, which can break such flows. Basically, don't access the global state through the render context, you almost never need to and it may be wrong. Trust in <code>#[template_rx]</code>.</p>\n","current_version":"0.3.4","manifest":{"0.1.x":{"docs_rs":"0.1","git":"v0.1.4","state":"outdated"},"0.2.x":{"docs_rs":"0.2","git":"v0.2.3","state":"outdated"},"0.3.0-0.3.3":{"docs_rs":"0.3.3","git":"v0.3.3","state":"outdated"},"0.3.4":{"docs_rs":"0.3","git":"v0.3.6","state":"outdated"},"0.4.x":{"docs_rs":"0.4","git":"HEAD","state":"stable"}},"sidebar_content":"<h1>Introduction</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/intro\">Introduction</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/what-is-perseus\">What is Perseus?</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/core-principles\">Core Principles</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/tutorials/hello-world\">Hello World!</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/tutorials/second-app\">Your Second App</a></li>\n</ul>\n<hr />\n<h1>Reference</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/perseus-app\"><code>PerseusApp</code></a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/define-app\"><code>define_app!</code></a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/views\">Writing Views</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/index-view\">The Index View</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/debugging\">Debugging</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/live-reloading\">Live Reloading</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/templates/intro\">Templates and Routing</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/templates/metadata-modification\">Modifying the <code>&lt;head&gt;</code></a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/templates/setting-headers\">Modifying HTTP Headers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/templates/router-state\">Listening to the Router</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/error-pages\">Error Pages</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/static-content\">Static Content</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/intro\">Internationalization</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/defining\">Defining Translations</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/using\">Using Translations</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/translations-managers\">Translations Managers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/other-engines\">Other Translation Engines</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/intro\">Rendering Strategies</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/build-state\">Build State</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/build-paths\">Build Paths</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/request-state\">Request State</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/revalidation\">Revalidation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/incremental\">Incremental Generation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/amalgamation\">State Amalgamation</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/hydration\">Hydration</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/rx\">Reactive State</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/global\">Global State</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/freezing\">State Freezing</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/idb-freezing\">Freezing to IndexedDB</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/hsr\">Hot State Reloading (HSR)</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/cli\">CLI</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/ejecting\">Ejecting</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/snooping\">Snooping</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/testing/intro\">Testing</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/testing/checkpoints\">Checkpoints</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/testing/fantoccini-basics\">Fantoccini Basics</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/testing/manual\">Manual Testing</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/styling\">Styling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/server-communication\">Communicating with a Server</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/stores\">Stores</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/exporting\">Static Exporting</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/intro\">Plugins</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/functional\">Functional Actions</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/control\">Control Actions</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/using\">Using Plugins</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/tinker\">The <code>tinker</code> Action</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/writing\">Writing Plugins</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/security\">Security Considerations</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/publishing\">Publishing Plugins</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/engines\">Engines</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/intro\">Deploying</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/serverful\">Server Deployment</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/serverless\">Serverless Deployment</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/size\">Optimizing Code Size</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/relative-paths\">Relative Paths</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/docker\">Docker Deployment</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/updating\">Migrating from v0.3.3</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/pitfalls-and-bugs\">Common Pitfalls and Known Bugs</a></li>\n</ul>\n<hr />\n<h1>Advanced</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/intro\">Under the Hood</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/arch\">Architecture</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/initial-loads\">Initial Loads</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/subsequent-loads\">Subsequent Loads</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/routing\">Routing</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/route-announcer\">Route Announcer</a></li>\n</ul>\n<hr />\n<h1>Further Tutorials</h1>\n<ul>\n<li><a href=\"docs/tutorials/auth\">Authentication</a></li>\n</ul>\n","status":"Outdated","title":"Global State"},"head":"<title>Global State | Perseus Docs</title><link rel=stylesheet href=.perseus/static/styles/markdown.css><link rel=stylesheet href=.perseus/static/styles/docs_links_markdown.css><link rel=stylesheet href=.perseus/static/prism.css>"}