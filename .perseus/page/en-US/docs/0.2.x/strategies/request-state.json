{"state":{"content":"<h1>Request State</h1>\n<p>While build-time strategies fulfill many use-cases, there are also scenarios in which you may need access to information only available at request-time, like an authentication key that the client sends over HTTP as a cookie. For these cases, Perseus supports the <em>request state</em> strategy, which is akin to traditional server-side rendering, whereby you render the page when a client requests it.</p>\n<p>If you can avoid this strategy, do, because it will bring your app's TTFB (time to first byte) down, remember that anything done in this strategy is done on the server while the client is waiting for a page.</p>\n<h2>Usage</h2>\n<p>Here's an example taken from <a href=\"https://github.com/framesurge/perseus/blob/main/examples/showcase/src/templates/ip.rs\">here</a> of using this strategy to tell the user their own IP address (albeit not hugely reliably as this header can be trivially spoofed, but this is for demonstration purposes):</p>\n<pre><code class=\"language-rust,no-run,no_playground\">use perseus::{Request, StringResultWithCause, Template};\nuse serde::{Deserialize, Serialize};\nuse std::rc::Rc;\nuse sycamore::prelude::{component, template, GenericNode, Template as SycamoreTemplate};\n\n#[derive(Serialize, Deserialize)]\npub struct IpPageProps {\n    ip: String,\n}\n\n#[component(IpPage&lt;G&gt;)]\npub fn dashboard_page(props: IpPageProps) -&gt; SycamoreTemplate&lt;G&gt; {\n    template! {\n        p {\n            (\n                format!(&quot;Your IP address is {}.&quot;, props.ip)\n            )\n        }\n    }\n}\n\npub fn get_template&lt;G: GenericNode&gt;() -&gt; Template&lt;G&gt; {\n    Template::new(&quot;ip&quot;)\n        .request_state_fn(Rc::new(get_request_state))\n        .template(template_fn())\n}\n\npub async fn get_request_state(_path: String, req: Request) -&gt; StringResultWithCause&lt;String&gt; {\n    // Err((&quot;this is a test error!&quot;.to_string(), perseus::ErrorCause::Client(None)))\n    Ok(serde_json::to_string(&amp;IpPageProps {\n        // Gets the client's IP address\n        ip: format!(\n            &quot;{:?}&quot;,\n            req.headers()\n                .get(&quot;X-Forwarded-For&quot;)\n                .unwrap_or(&amp;perseus::http::HeaderValue::from_str(&quot;hidden from view!&quot;).unwrap())\n        ),\n    })\n    .unwrap())\n}\n\npub fn template_fn&lt;G: GenericNode&gt;() -&gt; perseus::template::TemplateFn&lt;G&gt; {\n    Rc::new(|props| {\n        template! {\n            IpPage(\n                serde_json::from_str::&lt;IpPageProps&gt;(&amp;props.unwrap()).unwrap()\n            )\n        }\n    })\n}\n\n</code></pre>\n<p>Note that, just like <em>build state</em>, this strategy generates stringified properties that will be passed to the page to render it, and it also uses <code>StringResultWithCause</code> (see the section on <a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/build-state\">build state</a> for more information). The key difference though is that this strategy receives a second, very powerful parameter: the HTTP request that the user sent (<code>perseus::Request</code>).</p>\n<details>\n<summary>How do you get the user's request information?</summary>\n<p><a href=\"https://actix.rs\">Actix Web</a> (and any other framework worth its salt) automatically passes this information to handlers like Perseus. The slightly difficult thing is then converting this from Actix's custom format to Perseus' (which is just an alias for the <a href=\"https://docs.rs/http\"><code>http</code></a> module's). This is done in the <a href=\"https://docs.rs/perseus-actix-web\"><code>perseus-actix-web</code></a> crate.</p>\n</details>\n<p>That parameter is actually just an alias for <a href=\"https://docs.rs/http/0.2/http/request/struct.Request.html\">this</a>, which gives you access to all manner of things in the user's HTTP request. The main one we're concerned with in this example though is <code>X-Forwarded-For</code>, which contains the user's IP address (unless it's trivially spoofed). Because we can't assume that any HTTP header exists, we fall back to a message saying the IP address is hidden if we can't access the header.</p>\n<p>The other notable thing in the above example is the commented-out line at the beginning of <code>get_request_state</code>, which shows you how to return an error if the client didn't provide something that they should've.</p>\n","current_version":"0.2.x","manifest":{"0.1.x":{"docs_rs":"0.1","git":"v0.1.4","state":"outdated"},"0.2.x":{"docs_rs":"0.2","git":"v0.2.3","state":"outdated"},"0.3.0-0.3.3":{"docs_rs":"0.3.3","git":"v0.3.3","state":"outdated"},"0.3.4":{"docs_rs":"0.3","git":"v0.3.6","state":"outdated"},"0.4.x":{"docs_rs":"0.4","git":"HEAD","state":"stable"}},"sidebar_content":"<h1>Introduction</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/intro\">Introduction</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/what-is-perseus\">What is Perseus?</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/hello-world\">Hello World!</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/second-app\">Your Second App</a></li>\n</ul>\n<hr />\n<h1>Reference</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/define-app\"><code>define_app!</code></a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/views\">Writing Views</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/debugging\">Debugging</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/templates/intro\">Templates and Routing</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/templates/metadata-modification\">Modifying the <code>&lt;head&gt;</code></a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/templates/setting-headers\">Modifying HTTP Headers</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/error-pages\">Error Pages</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/static-content\">Static Content</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/intro\">Internationalization</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/defining\">Defining Translations</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/using\">Using Translations</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/translations-managers\">Translations Managers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/other-engines\">Other Translation Engines</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/intro\">Rendering Strategies</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/build-state\">Build State</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/build-paths\">Build Paths</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/request-state\">Request State</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/revalidation\">Revalidation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/incremental\">Incremental Generation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/amalgamation\">State Amalgamation</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/cli\">CLI</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/ejecting\">Ejecting</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/config-managers\">Config Managers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/testing/intro\">Testing</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/testing/checkpoints\">Checkpoints</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/testing/fantoccini-basics\">Fantoccini Basics</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/testing/manual\">Manual Testing</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/styling\">Styling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/deploying/intro\">Deploying</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/deploying/exporting\">Static Exporting</a></li>\n<li><a href=\"\">Server Deployment</a></li>\n<li><a href=\"\">Serverless Deployment</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/updating\">Migrating from v0.1.x</a></li>\n</ul>\n<hr />\n<h1>Advanced</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/intro\">Under the Hood</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/arch\">Architecture</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/initial-loads\">Initial Loads</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/subsequent-loads\">Subsequent Loads</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/routing\">Routing</a></li>\n</ul>\n</li>\n</ul>\n","status":"Outdated","title":"Request State"},"head":"<title>Request State | Perseus Docs</title><link rel=stylesheet href=.perseus/static/styles/markdown.css><link rel=stylesheet href=.perseus/static/styles/docs_links_markdown.css><link rel=stylesheet href=.perseus/static/prism.css>"}