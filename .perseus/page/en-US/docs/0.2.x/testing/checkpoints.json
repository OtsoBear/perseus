{"state":{"content":"<h1>Checkpoints</h1>\n<p>If you start using Perseus' testing system now, you'll likely hit a snag very quickly, involving errors to do with <em>stale DOM elements</em>. This is an unfortunate side-effect of the way Perseus currently handles initial loads (we move a number of DOM elements around after they've been sent down from the server), which results in the WebDriver thinking half the page has just disappeared out from under it!</p>\n<p>This, and many similar problems, are easily solvable using one of Perseus' most powerful testing tools: <em>checkpoints</em>. When you run your app with <code>perseus test</code>, a system is enabled in the background that writes a new DOM element to a hidden list of them when any app code calls <code>checkpoint()</code>. This can then be detected with Fantoccini! Admittedly, a far nicer solution would be DOM events, but the WebDriver protocol doesn't yet support listening for them (understandable since it's mimicking a user's interaction with the browser).</p>\n<p>Note that checkpoints will never be reached if your app is not run with <code>perseus test</code>. If you use <code>--no-run</code> and then execute the server binary manually, be sure to provide the <code>PERSEUS_TESTING=true</code> environment variable.</p>\n<p>You can wait for a Perseus checkpoint to be reached like so (taken from <a href=\"https://github.com/framesurge/perseus/blob/main/examples/basic/tests/main.rs\">here</a>):</p>\n<pre><code class=\"language-rust\">use fantoccini::{Client, Locator};\nuse perseus::wait_for_checkpoint;\n\n#[perseus::test]\nasync fn main(c: &amp;mut Client) -&gt; Result&lt;(), fantoccini::error::CmdError&gt; {\n    c.goto(&quot;http://localhost:8080&quot;).await?;\n    wait_for_checkpoint!(&quot;begin&quot;, 0, c);\n    let url = c.current_url().await?;\n    assert!(url.as_ref().starts_with(&quot;http://localhost:8080&quot;));\n\n    // The greeting was passed through using build state\n    wait_for_checkpoint!(&quot;initial_state_present&quot;, 0, c);\n    wait_for_checkpoint!(&quot;page_visible&quot;, 0, c);\n    let greeting = c.find(Locator::Css(&quot;p&quot;)).await?.text().await?;\n    assert_eq!(greeting, &quot;Hello World!&quot;);\n    // For some reason, retrieving the inner HTML or text of a `&lt;title&gt;` doens't work\n    let title = c.find(Locator::Css(&quot;title&quot;)).await?.html(false).await?;\n    assert_eq!(title, &quot;&lt;title&gt;Index Page | Perseus Example – Basic&lt;/title&gt;&quot;);\n\n    // Go to `/about`\n    c.find(Locator::Id(&quot;about-link&quot;)).await?.click().await?;\n    let url = c.current_url().await?;\n    assert!(url.as_ref().starts_with(&quot;http://localhost:8080/about&quot;));\n    wait_for_checkpoint!(&quot;initial_state_not_present&quot;, 0, c);\n    wait_for_checkpoint!(&quot;page_visible&quot;, 1, c);\n    // Make sure the hardcoded text there exists\n    let text = c.find(Locator::Css(&quot;p&quot;)).await?.text().await?;\n    assert_eq!(text, &quot;About.&quot;);\n    let title = c.find(Locator::Css(&quot;title&quot;)).await?.html(false).await?;\n    assert_eq!(title, &quot;&lt;title&gt;About Page | Perseus Example – Basic&lt;/title&gt;&quot;);\n    // Make sure we get initial state if we refresh\n    c.refresh().await?;\n    wait_for_checkpoint!(&quot;initial_state_present&quot;, 0, c);\n\n    Ok(())\n}\n\n</code></pre>\n<p>Note in particular the use of the <code>wait_for_checkpoint!</code> macro, which accepts three arguments:</p>\n<ul>\n<li>Name of the checkpoint</li>\n<li>Version of the checkpoint</li>\n<li>Fantoccini client</li>\n</ul>\n<p>For want of a better term, that second argument refers to how Perseus manages checkpoints. Because a single checkpoint might be emitted multiple times, Perseus attaches a number to the end of each. The final element <code>id</code> looks like this: <code>__perseus_checkpoint-&lt;checkpoint_name&gt;-&lt;number&gt;</code>, where <code>&lt;number&gt;</code> starts from 0 and increments.</p>\n<p><em>Note: checkpoints are not cleared until the page is fully reloaded, so clicking a link to another page will not clear them!</em></p>\n<h2>Custom Checkpoints</h2>\n<p>In addition to Perseus' internal checkpoints (listed below), you can also use your own checkpoints, though they must follow the following criteria:</p>\n<ul>\n<li>Must not include hyphens (used as a delimiter character), use underscores instead</li>\n<li>Must not conflict with an internal Perseus checkpoint name</li>\n</ul>\n<p>The best way to uphold the latter of those criteria is to prefix your own checkpoints with something like the name of your app, or even just <code>custom_</code>. Of course, if your app has a name like <code>router</code>, then that will be a problem (many Perseus checkpoints begin with <code>router_</code>), but Perseus will never generate checkpoints internally that begin with <code>custom_</code>.</p>\n<p>Note that it's not enough to make sure that your checkpoints don't clash with any existing checkpoints, as new checkpoints may be added in any new release of Perseus, so conflicts may arise with the tiniest of updates!</p>\n<h2>Internal Checkpoints</h2>\n<p>Perseus has a number of internal checkpoints that are listed below. Note that this list will increase over time, and potentially in patch releases.</p>\n<ul>\n<li><code>begin</code> -- when the Perseus system has been initialized</li>\n<li><code>router_entry</code> -- when the Perseus router has reached a verdict and is about to either render a new page, detect the user's locale and redirect, or show an error page</li>\n<li><code>not_found</code> -- when the page wasn't found</li>\n<li><code>app_shell_entry</code> -- when the page was found and it's being rendered</li>\n<li><code>initial_state_present</code> -- when the page has been rendered for the first time, and the server has preloaded everything (see <a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/initial-loads\">here</a> for details)</li>\n<li><code>page_visible</code> -- when the user is able to see page content (but the page isn't interactive yet)</li>\n<li><code>page_interactive</code> -- when the page has been hydrated, and is now interactive</li>\n<li><code>initial_state_not_present</code> -- when the initial state is not present, and the app shell will need to fetch page data from the server</li>\n<li><code>initial_state_error</code> -- when initial state showed an error</li>\n</ul>\n","current_version":"0.2.x","manifest":{"0.1.x":{"docs_rs":"0.1","git":"v0.1.4","state":"outdated"},"0.2.x":{"docs_rs":"0.2","git":"v0.2.3","state":"outdated"},"0.3.0-0.3.3":{"docs_rs":"0.3.3","git":"v0.3.3","state":"outdated"},"0.3.4":{"docs_rs":"0.3","git":"v0.3.6","state":"outdated"},"0.4.x":{"docs_rs":"0.4","git":"HEAD","state":"stable"}},"sidebar_content":"<h1>Introduction</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/intro\">Introduction</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/what-is-perseus\">What is Perseus?</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/hello-world\">Hello World!</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/second-app\">Your Second App</a></li>\n</ul>\n<hr />\n<h1>Reference</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/define-app\"><code>define_app!</code></a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/views\">Writing Views</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/debugging\">Debugging</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/templates/intro\">Templates and Routing</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/templates/metadata-modification\">Modifying the <code>&lt;head&gt;</code></a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/templates/setting-headers\">Modifying HTTP Headers</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/error-pages\">Error Pages</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/static-content\">Static Content</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/intro\">Internationalization</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/defining\">Defining Translations</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/using\">Using Translations</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/translations-managers\">Translations Managers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/i18n/other-engines\">Other Translation Engines</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/intro\">Rendering Strategies</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/build-state\">Build State</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/build-paths\">Build Paths</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/request-state\">Request State</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/revalidation\">Revalidation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/incremental\">Incremental Generation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/strategies/amalgamation\">State Amalgamation</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/cli\">CLI</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/ejecting\">Ejecting</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/config-managers\">Config Managers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/testing/intro\">Testing</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/testing/checkpoints\">Checkpoints</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/testing/fantoccini-basics\">Fantoccini Basics</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/testing/manual\">Manual Testing</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/styling\">Styling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/deploying/intro\">Deploying</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/deploying/exporting\">Static Exporting</a></li>\n<li><a href=\"\">Server Deployment</a></li>\n<li><a href=\"\">Serverless Deployment</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/updating\">Migrating from v0.1.x</a></li>\n</ul>\n<hr />\n<h1>Advanced</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/intro\">Under the Hood</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/arch\">Architecture</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/initial-loads\">Initial Loads</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/subsequent-loads\">Subsequent Loads</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/0.2.x/advanced/routing\">Routing</a></li>\n</ul>\n</li>\n</ul>\n","status":"Outdated","title":"Checkpoints"},"head":"<title>Checkpoints | Perseus Docs</title><link rel=stylesheet href=.perseus/static/styles/markdown.css><link rel=stylesheet href=.perseus/static/styles/docs_links_markdown.css><link rel=stylesheet href=.perseus/static/prism.css>"}